stage('Deploy') {
    steps {
        script {
            sh '''
                echo "Deploying Flask application..."
                . venv/bin/activate
                
                # Kill any existing Flask process
                pkill -f "python.*app.py" || true
                sleep 2
                
                # Start Flask application in background
                nohup python3 app.py > flask.log 2>&1 &
                
                # Wait a moment and check if it's running
                sleep 3
                
                # Test if Flask is responding
                curl -f http://localhost:5000 && echo "✅ Flask deployed successfully!" || echo "⚠️ Flask might still be starting"
                
                echo "Deployment completed"
            '''
        }
    }
}
